Centos 7最小化安装后配置
参考资料：https://www.cnblogs.com/mxhei/articles/7102086.html

1、大多数情况下selinux会阻碍你学习或工作，除非你比较熟悉selinx的配置，所以先关闭它
#关闭SELINUX
sed -n '/SELINUX=enforcing/p' /etc/selinux/config  # 修改前查看
sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config 
sed -n '/SELINUX=/p' /etc/selinux/config |grep -v '#' # 修改后查看

getenforce	# 当前selinux开启状态
setenforce 0	# 不重启机器的前提下，临时关闭

# 如果不需要防火墙
systemctl stop firewalld
systemctl disable firewalld

2、配置网卡(最小化安装后ifconfig无法使用)
cat >/etc/sysconfig/network-scripts/ifcfg-eth0 <<EOF
###############################
# vim /etc/sysconfig/network-scripts/ifcfg-eth0 
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
NAME=eth0
#UUID=2634ad12-445a-4860-aa56-b37825b36afe
DEVICE=eth0
ONBOOT=yes
IPADDR=172.16.110.126
PREFIX=24
GATEWAY=172.16.110.250
DNS1=172.16.110.11
IPV6_PEERDNS=yes
IPV6_PEERROUTES=yes
IPV6_PRIVACY=no
###############################
EOF

# 配置DNS
cat >/etc/resolv.conf <<EOF
# Generated by NetworkManager
nameserver 172.16.110.11
EOF

3、更新yum源
yum -y update

4、联网后安装ifconfig
yum -y install net-tools

5、安装常用工具
yum -y install curl telnet vim wget lrzsz
#修改vim配置，注意文件中用"来注释
cat >~/.vimrc <<"EOF"
set encoding=utf-8 "文件编码
set number "显示行号
set tabstop=4 "tab宽度为4
set softtabstop=4 "设置一次可以删除4个空格
set expandtab "tab转换为空格
set nowrap "不自动换行
set showmatch "显示括号配对情况
syntax on "开启语法高亮
EOF

6、修改history大小
vim /etc/profile
HISTSIZE=2000

7、设置时区为上海时区
ll /etc/localtime
#如果不为上海时区则执行
rm -rf /etc/localtime 
ln -s /etc/localtime /usr/share/zoneinfo/Asia/Shanghai

8、推荐安装依赖关系
yum -y install gcc gcc-c++ make autoconf wget lrzsz libjpeg libjpeg-devel libpng libpng-devel  
yum -y install libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel   
yum -y install curl curl-devel e2fsprogs e2fsprogs-devel krb5-devel libidn libidn-devel openssl openssl-devel  
yum -y install libevent-devel libtool libtool-ltdl bison gd gd-devel vim-enhanced pcre-devel ncurses
yum -y install sysstat patch bc expect rsync ncurses-devel libxslt-devel zip unzip ntpdate sqlite-devel 
yum -y install automake cmake libaio libaio-devel  boost freetype freetype-devel aspell-devel net-snmp-devel 
yum -y install gmp-devel libc-client-devel openldap-devel unixODBC-devel pspell-devel postgresql-devel 
yum -y install redhat-lsb epel-release libmemcached libmemcached-devel db4-devel libXpm-devel tree
yum -y groupinstall "Development tools" "GNOME Desktop" "Legacy UNIX Compatibility"  libvpx-devel  enchant-devel
yum -y groupinstall "System Administration Tools" "System Management"   libicu-devel libc-client-devel


9、安装TMUX终端复用软件
cd /usr/local/src/
wget https://github.com/libevent/libevent/releases/download/release-2.1.8-stable/libevent-2.1.8-stable.tar.gz 
wget https://github.com/tmux/tmux/releases/download/2.3/tmux-2.3.tar.gz
#编译安装
tar xzf libevent-2.1.8-stable.tar.gz
cd libevent-2.1.8-stable
./configure 
make -j `grep processor /proc/cpuinfo | wc -l` 
make -j `grep processor /proc/cpuinfo | wc -l`  install
#安装
cd /usr/local/src/
tar xzf tmux-2.3.tar.gz 
cd tmux-2.3 
CFLAGS="-I/usr/local/include" LDFLAGS="-L//usr/local/lib" ./configure 
make -j `grep processor /proc/cpuinfo | wc -l` 
make -j `grep processor /proc/cpuinfo | wc -l`  install
#创建软连接 
#32位系统： 
#ln -s /usr/local/lib/libevent-2.1.so.6 /usr/lib/libevent-2.1.so.6
#64位系统： 
ln -s /usr/local/lib/libevent-2.1.so.6 /usr/lib64/libevent-2.1.so.6

10、优化系统参数

cat >>/etc/security/limits.conf <<EOF
*  soft  nofile  65536
*  hard  nofile  65536
EOF


# sed -i 's#4096#65535#g'   /etc/security/limits.d/20-nproc.conf 

cat >/etc/security/limits.d/20-nproc.conf<<EOF
# Default limit for number of user's processes to prevent
# accidental fork bombs.
# See rhbz #432903 for reasoning.
*          soft    nproc     10240
root       soft    nproc     unlimited
EOF

11、给/etc/rc.local添加执行权限
chmod +x /etc/rc.d/rc.local

12、配置sshd
sed -i -e '49s/^#//g' /etc/ssh/sshd_config            ##启用49行配置
sed -i -e '49s/yes/no/g' /etc/ssh/sshd_config         ##禁止root使用ssh登录
sed -i -e '129s/#/ /g' /etc/ssh/sshd_config           ##禁止UseDNS 
sed -i -e '129s/yes$/no/g' /etc/ssh/sshd_config
sed -i '/^GSS/s/yes/no/g' /etc/ssh/sshd_config        ##禁用GSSAPI认证加快登录速度
systemctl restart sshd                                ##重新启动服务
systemctl enable sshd                                 ##设置为开机启动
systemctl status sshd                                 ##查看状态

13、优化内核参数

cat >/etc/sysctl.conf <<EOF
#CTCDN系统优化参数
#关闭ipv6
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1
#决定检查过期多久邻居条目
net.ipv4.neigh.default.gc_stale_time=120
#使用arp_announce / arp_ignore解决ARP映射问题
net.ipv4.conf.default.arp_announce = 2
net.ipv4.conf.all.arp_announce=2
net.ipv4.conf.lo.arp_announce=2
# 避免放大攻击
net.ipv4.icmp_echo_ignore_broadcasts = 1
# 开启恶意icmp错误消息保护
net.ipv4.icmp_ignore_bogus_error_responses = 1
#关闭路由转发
net.ipv4.ip_forward = 0
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0
#开启反向路径过滤
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1
#处理无源路由的包
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0
#关闭sysrq功能
kernel.sysrq = 0
#core文件名中添加pid作为扩展名
kernel.core_uses_pid = 1
# 开启SYN洪水攻击保护
net.ipv4.tcp_syncookies = 1
#修改消息队列长度
kernel.msgmnb = 65536
kernel.msgmax = 65536
#设置最大内存共享段大小bytes
kernel.shmmax = 68719476736
kernel.shmall = 4294967296
#timewait的数量，默认180000
net.ipv4.tcp_max_tw_buckets = 6000
net.ipv4.tcp_sack = 1
net.ipv4.tcp_window_scaling = 1
net.ipv4.tcp_rmem = 4096        87380   4194304
net.ipv4.tcp_wmem = 4096        16384   4194304
net.core.wmem_default = 8388608
net.core.rmem_default = 8388608
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
#每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目
net.core.netdev_max_backlog = 262144
#限制仅仅是为了防止简单的DoS 攻击
net.ipv4.tcp_max_orphans = 3276800
#未收到客户端确认信息的连接请求的最大值
net.ipv4.tcp_max_syn_backlog = 262144
net.ipv4.tcp_timestamps = 0
#内核放弃建立连接之前发送SYNACK 包的数量
net.ipv4.tcp_synack_retries = 1
#内核放弃建立连接之前发送SYN 包的数量
net.ipv4.tcp_syn_retries = 1
#启用timewait 快速回收
net.ipv4.tcp_tw_recycle = 1
#开启重用。允许将TIME-WAIT sockets 重新用于新的TCP 连接
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_mem = 94500000 915000000 927000000
net.ipv4.tcp_fin_timeout = 1
#当keepalive 起用的时候，TCP 发送keepalive 消息的频度。缺省是2 小时
net.ipv4.tcp_keepalive_time = 1800
net.ipv4.tcp_keepalive_probes = 3
net.ipv4.tcp_keepalive_intvl = 15
#允许系统打开的端口范围
net.ipv4.ip_local_port_range = 1024    65000
#修改防火墙表大小，默认65536
net.netfilter.nf_conntrack_max=655350
net.netfilter.nf_conntrack_tcp_timeout_established=1200
# 确保无人能修改路由表
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
#本文出自 “兰芷” 博客，请务必保留此出处http://7826443.blog.51cto.com/7816443/1775248
EOF







